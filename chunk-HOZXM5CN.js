import{f as P,g as G,h as j}from"./chunk-YTLR5RWA.js";import{$ as o,F as a,Ha as et,K as d,Kb as jt,M as T,Mb as Ot,N as Z,Nb as ot,Pb as rt,R as w,Sb as at,Sc as R,Tb as ct,U as l,Ub as lt,V as p,Va as it,Vb as Vt,W as tt,Wb as pt,X as V,Y as A,Ya as nt,Yb as st,Z as u,_ as r,a as q,aa as h,b as Et,d as J,e as kt,eb as H,g as It,h as Lt,ha as g,j as Tt,ja as _,ka as s,kb as U,l as wt,n as Rt,q as y,qb as Pt,r as X,ra as K,t as C,tb as yt,td as $,v as f,w as v,wa as c,xa as S,ya as x}from"./chunk-KPKDQF2Q.js";import"./chunk-C6Q5SG76.js";function At(e){if(!e)return"";let i=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${i}-${t}-${n}`}var b=class e{location=new J("kudakuda_stock");location$=this.location.asObservable();selectedDate=new J(At(new Date));selectedDate$=this.selectedDate.asObservable();dateAndLocationKey$=Lt([this.location$,this.selectedDate$]).pipe(It(([i,t])=>`${i}_${t.replace(/-/g,"")}`));getCurrentDateAndLocationKey(){let i=this.location.getValue(),t=this.selectedDate.getValue();return`${i}_${t.replace(/-/g,"")}`}constructor(){}setLocation(i){this.location.next(i)}setDate(i){let t;if(typeof i=="string"){let n=i.split("-");t=n[2]?`${n[2]}-${n[1]}-${n[0]}`:i}else t=At(i);this.selectedDate.next(t)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var E=class e{constructor(i,t){this.appState=i;this.http=t}apiUrl=$.JSON_BIN_API_URL;static \u0275fac=function(t){return new(t||e)(C(b),C(U))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var F=class e{constructor(i,t){this.lookupService=i;this.appState=t}static \u0275fac=function(t){return new(t||e)(C(E),C(b))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var I=class e{constructor(i,t){this.lookupService=i;this.appState=t}getPrice(){return new Et(i=>{i.next({effDate:"",products:[],itemType:"products",saleAmt:0,stockAmt:0}),i.complete()})}static \u0275fac=function(t){return new(t||e)(C(E),C(b))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var N=class e{constructor(i,t){this.lookupService=i;this.appState=t}static \u0275fac=function(t){return new(t||e)(C(E),C(b))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var Q=class e{constructor(){}static \u0275fac=function(t){return new(t||e)};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};function qt(e,i){e&1&&c(0," Load ")}function Ht(e,i){e&1&&(h(0,"span",6),c(1," Loading... "))}function Ut(e,i){if(e&1){let t=g();r(0,"button",5),_("click",function(){f(t);let m=s();return v(m.buildReport())}),l(1,qt,1,0),l(2,Ht,2,0),o()}if(e&2){let t=s();u("disabled",t.isLoading),a(),p(t.isLoading?-1:1),a(),p(t.isLoading?2:-1)}}function Gt(e,i){e&1&&(r(0,"div",3),c(1,'Click "Load" to generate the R-1 report.'),o())}function zt(e,i){e&1&&(r(0,"div",4)(1,"div",7)(2,"span",8),c(3,"Loading..."),o()()())}function Qt(e,i){e&1&&(r(0,"div",9),c(1,"No stock or price data available to generate a report for the selected date."),o())}function Yt(e,i){if(e&1&&(r(0,"div",3),c(1),o()),e&2){let t=s(2);a(),x("No previous saved date found before ",t.selectedDate)}}function Jt(e,i){e&1&&(r(0,"tr")(1,"th"),c(2,"Type"),o(),r(3,"th",16),c(4,"Previous Stock"),o(),r(5,"th",16),c(6,"Receipt"),o(),r(7,"th",16),c(8,"Sales"),o(),r(9,"th",16),c(10,"Current Stock"),o()())}function Kt(e,i){if(e&1&&(r(0,"tr")(1,"td")(2,"strong"),c(3),o()(),r(4,"td",16),c(5),o(),r(6,"td",16),c(7),o(),r(8,"td",16),c(9),o(),r(10,"td",16),c(11),o()()),e&2){let t=i.$implicit,n=s(4);a(3),S(t.type),a(2),S(n.displayVal(t.prev)),a(2),S(n.displayVal(t.receipt)),a(2),S(n.displayVal(t.sales)),a(2),S(n.displayVal(t.curr))}}function Wt(e,i){if(e&1&&V(0,Kt,12,5,"tr",null,tt),e&2){let t=s(3);A(t.rows)}}function Xt(e,i){if(e&1){let t=g();r(0,"div",10)(1,"p-table",11),w(2,Jt,11,0,"ng-template",12)(3,Wt,2,0,"ng-template",13),o(),r(4,"div",14)(5,"button",15),_("click",function(){f(t);let m=s(2);return v(m.exportAsPdf())}),o()()()}if(e&2){let t=s(2);a(),u("value",t.rows),a(4),u("disabled",t.rows.length===0)}}function Zt(e,i){if(e&1&&(l(0,Qt,2,0,"div",9),l(1,Yt,2,1,"div",3),l(2,Xt,6,2,"div",10)),e&2){let t=s();p(t.noDataAvailable?0:-1),a(),p(!t.noDataAvailable&&!t.prevDate?1:-1),a(),p(t.noDataAvailable?-1:2)}}var mt=class e{constructor(i,t,n,m,k,L,$t){this.appState=i;this.stockService=t;this.productService=n;this.receiptService=m;this.lookupService=k;this.cd=L;this.pdfExportService=$t}formatDisplayDate(i){return i?new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}buildReport(){}displayVal(i){return i==null?"":typeof i=="object"?Object.values(i).filter(t=>t!=null).join(", "):i.toString()}exportAsPdf(){}selectedDate=null;prevDate=null;rows=[];isDataLoaded=!1;isLoading=!1;noDataAvailable=!1;reportSummary=null;sub=null;ngOnInit(){let i=this.appState.selectedDate$.subscribe(t=>{this.selectedDate!==t&&(this.selectedDate=t,this.isDataLoaded=!1)});this.sub=i}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}static \u0275fac=function(t){return new(t||e)(d(b),d(F),d(I),d(N),d(E),d(it),d(Q))};static \u0275cmp=T({type:e,selectors:[["app-r1-report"]],decls:9,vars:5,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],["pButton","","type","button",1,"p-button-primary",3,"disabled"],[1,"alert","alert-info"],[1,"text-center","mt-4"],["pButton","","type","button",1,"p-button-primary",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"alert","alert-warning","mt-3"],[1,"mt-3"],["styleClass","p-datatable-sm p-datatable-striped p-datatable-gridlines",3,"value"],["pTemplate","header"],["pTemplate","body"],[1,"mt-3","text-end"],["pButton","","type","button","label","Export R-1 PDF","icon","pi pi-file-pdf",1,"p-button-danger",3,"click","disabled"],[1,"text-end"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3"),c(3),o(),r(4,"div"),l(5,Ut,3,3,"button",2),o()(),l(6,Gt,2,0,"div",3),l(7,zt,4,0,"div",4),l(8,Zt,3,3),o()),t&2&&(a(3),x("R-1 Report ",n.formatDisplayDate(n.selectedDate)),a(2),p(n.isDataLoaded?-1:5),a(),p(!n.isDataLoaded&&!n.isLoading?6:-1),a(),p(n.isLoading?7:-1),a(),p(n.isDataLoaded&&!n.isLoading?8:-1))},dependencies:[j,P,R],styles:[".text-end[_ngcontent-%COMP%]{text-align:right}"]})};var ee=(e,i)=>({"alert-success":e,"alert-danger":i});function ie(e,i){e&1&&c(0," Load ")}function ne(e,i){e&1&&(h(0,"span",8),c(1," Loading... "))}function oe(e,i){if(e&1){let t=g();r(0,"button",7),_("click",function(){f(t);let m=s();return v(m.buildReport())}),l(1,ie,1,0),l(2,ne,2,0),o()}if(e&2){let t=s();u("disabled",t.isLoading),a(),p(t.isLoading?-1:1),a(),p(t.isLoading?2:-1)}}function re(e,i){e&1&&(h(0,"span",8),c(1," Saving... "))}function ae(e,i){e&1&&c(0," Save ")}function ce(e,i){if(e&1){let t=g();r(0,"button",9),_("click",function(){f(t);let m=s();return v(m.saveChanges())}),l(1,re,2,0),l(2,ae,1,0),o()}if(e&2){let t=s();u("disabled",!t.hasChanges||t.isSaving),a(),p(t.isSaving?1:-1),a(),p(t.isSaving?-1:2)}}function le(e,i){e&1&&(r(0,"div",4),c(1,'Click "Load Report" to generate the sales report.'),o())}function pe(e,i){e&1&&(r(0,"div",5)(1,"div",10)(2,"span",11),c(3,"Loading..."),o()()())}function se(e,i){if(e&1&&(r(0,"div",12),c(1),o()),e&2){let t=s(2);u("ngClass",et(2,ee,t.saveStatus.type==="success",t.saveStatus.type==="error")),a(),x(" ",t.saveStatus.message," ")}}function me(e,i){e&1&&(r(0,"div",13),c(1,"No stock or price data available to generate a report for the selected date."),o())}function de(e,i){if(e&1&&(r(0,"div",4),c(1),o()),e&2){let t=s(2);a(),x("No previous saved date found before ",t.selectedDate)}}function ue(e,i){if(e&1&&(r(0,"div",14),h(1,"p-table",15),o()),e&2){let t=s(2);a(),u("value",t.rows)("scrollable",!0)}}function fe(e,i){if(e&1&&(l(0,se,2,5,"div",12),l(1,me,2,0,"div",13),l(2,de,2,1,"div",4),l(3,ue,2,2,"div",14)),e&2){let t=s();p(t.saveStatus?0:-1),a(),p(t.noDataAvailable?1:-1),a(),p(!t.noDataAvailable&&!t.prevDate?2:-1),a(),p(t.noDataAvailable?-1:3)}}function ve(e,i){if(e&1&&(r(0,"tr")(1,"th",16),c(2,"Index"),o(),r(3,"th",17),c(4,"Name"),o(),r(5,"th",18),c(6),o()()),e&2){let t=s();a(6),x("Prev (",t.formatHeaderDate(t.prevDate),")")}}var vt=class e{constructor(i,t,n,m,k,L,$t){this.appState=i;this.stockService=t;this.productPriceService=n;this.receiptService=m;this.pdfExportService=k;this.itemBinLookupService=L;this.cdr=$t}selectedDate=null;prevDate=null;rows=[];editRows=[];totalAmount=0;isDataLoaded=!1;isLoading=!1;isSaving=!1;noDataAvailable=!1;hasReceiptData=!1;hasChanges=!1;editingRowIndex=null;saveStatus=null;sub=null;productMap=new Map;ngOnInit(){}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}formatDisplayDate(i){return i?new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}formatHeaderDate(i){return i?new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}buildReport(){}saveChanges(){this.saveStatus={type:"success",message:"Report saved successfully."},this.hasChanges=!1}static \u0275fac=function(t){return new(t||e)(d(b),d(F),d(I),d(N),d(Q),d(E),d(it))};static \u0275cmp=T({type:e,selectors:[["app-day-sales-report"]],decls:11,vars:6,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],["pButton","","type","button",1,"p-button-primary",3,"disabled"],["pButton","","type","button","label","Save",1,"p-button-success","ms-2",3,"disabled"],[1,"alert","alert-info"],[1,"text-center","mt-4"],["pTemplate","header"],["pButton","","type","button",1,"p-button-primary",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["pButton","","type","button","label","Save",1,"p-button-success","ms-2",3,"click","disabled"],["role","status",1,"spinner-border"],[1,"visually-hidden"],["role","alert",1,"alert","mt-2",3,"ngClass"],[1,"alert","alert-warning","mt-3"],[1,"mt-3"],["scrollHeight","calc(100vh - 150px)","styleClass","p-datatable-sm p-datatable-striped p-datatable-gridlines",3,"value","scrollable"],["pFrozenColumn","","rowspan","2",2,"width","70px"],["pFrozenColumn","","rowspan","2",2,"width","250px"],["colspan","4",1,"text-center",2,"width","400px"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3"),c(3),o(),r(4,"div"),l(5,oe,3,3,"button",2),l(6,ce,3,3,"button",3),o()(),l(7,le,2,0,"div",4),l(8,pe,4,0,"div",5),l(9,fe,4,4),w(10,ve,7,1,"ng-template",6),o()),t&2&&(a(3),x("Sales Report ",n.formatDisplayDate(n.selectedDate)),a(2),p(n.isDataLoaded?-1:5),a(),p(n.isDataLoaded?6:-1),a(),p(!n.isDataLoaded&&!n.isLoading?7:-1),a(),p(n.isLoading?8:-1),a(),p(n.isDataLoaded&&!n.isLoading?9:-1))},dependencies:[j,P,R,G,H,nt],styles:[".disabled-cell[_ngcontent-%COMP%]{background-color:#f0f0f0!important;color:#b0b0b0!important}.editable-cell[_ngcontent-%COMP%]{cursor:pointer}.editable-cell[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.editable-cell[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:7ch;width:100%}.editable-row[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.edit-trigger-cell[_ngcontent-%COMP%]{cursor:pointer}"]})};var Y=class e{constructor(i){this.http=i}isAuthenticated(){return!!this.authToken}login(i,t){let n=`${this.baseUrl}/_session`;return this.http.post(n,{name:i,password:t}).pipe(Rt(m=>{m.ok&&(this.authToken="dummy-token",this.currentUser$.next(i),localStorage.setItem("authToken",this.authToken))}))}baseUrl=$.BASE_URL;defaultDb=$.DB_NAME;authToken=null;currentUser$=new J(null);static \u0275fac=function(t){return new(t||e)(C(U))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var B=class e{constructor(i,t,n){this.http=i;this.couchdb=t;this.lookupService=n}apiUrl=$.JSON_BIN_API_URL;static \u0275fac=function(t){return new(t||e)(C(U),C(Y),C(E))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var M=class e{constructor(i){this.couchdb=i}getPrice(){return kt({products:[]})}static \u0275fac=function(t){return new(t||e)(C(Y))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ce=(e,i)=>({"alert-success":e,"alert-danger":i});function Se(e,i){let t;return(t=i.get("seq"))==null?null:t.value}function be(e,i){e&1&&h(0,"span",9)}function ye(e,i){if(e&1){let t=g();r(0,"button",8),_("click",function(){f(t);let m=s();return v(m.copyDataToCouch())}),l(1,be,1,0,"span",9),o()}if(e&2){let t=s();u("disabled",t.isCopying),a(),p(t.isCopying?1:-1)}}function ge(e,i){if(e&1){let t=g();r(0,"button",10),_("click",function(){f(t);let m=s();return v(m.loadData())}),o()}}function xe(e,i){e&1&&c(0," Save ")}function he(e,i){e&1&&(h(0,"span",11),c(1," Saving... "))}function De(e,i){if(e&1&&(r(0,"button",5),l(1,xe,1,0),l(2,he,2,0),o()),e&2){let t=s();u("disabled",t.isSaving),a(),p(t.isSaving?-1:1),a(),p(t.isSaving?2:-1)}}function Ee(e,i){if(e&1&&(r(0,"p",14),c(1),o()),e&2){let t=s(2);a(),S(t.copyProgress)}}function ke(e,i){if(e&1&&(r(0,"div",6)(1,"div",12)(2,"span",13),c(3),o()(),l(4,Ee,2,1,"p",14),o()),e&2){let t=s();a(3),x("",t.isLoading?"Loading":"Copying","..."),a(),p(t.copyProgress?4:-1)}}function Ie(e,i){e&1&&(r(0,"div",7),c(1,' Click "Load Data" to view and edit receipts. '),o())}function Le(e,i){if(e&1&&(r(0,"div",15),c(1),o()),e&2){let t=s(2);u("ngClass",et(2,Ce,!t.savedMessage.includes("failed"),t.savedMessage.includes("failed"))),a(),x(" ",t.savedMessage," ")}}function Te(e,i){e&1&&(r(0,"tr")(1,"th",20),c(2,"Index"),o(),r(3,"th",21),c(4,"Name"),o(),r(5,"th",22),c(6,"Q Qty"),o(),r(7,"th",22),c(8,"P Qty"),o(),r(9,"th",22),c(10,"N Qty"),o(),r(11,"th",22),c(12,"D Qty"),o()())}function we(e,i){if(e&1&&h(0,"tr",23),e&2){let t=i.$index;u("formGroupName",t)}}function Re(e,i){if(e&1&&V(0,we,1,1,"tr",23,Se),e&2){let t=s(2);A(t.rows.controls)}}function Pe(e,i){if(e&1){let t=g();l(0,Le,2,5,"div",15),r(1,"form",16),_("ngSubmit",function(){f(t);let m=s();return v(m.save())}),r(2,"p-table",17),w(3,Te,13,0,"ng-template",18)(4,Re,2,0,"ng-template",19),o()()}if(e&2){let t=s();p(t.savedMessage?0:-1),a(),u("formGroup",t.form),a(),u("value",t.rows.controls)("scrollable",!0)}}var _t=class e{constructor(i,t,n,m,k,L){this.fb=i;this.appState=t;this.receiptService=n;this.productService=m;this.couchSync=k;this.couchData=L;this.form=this.fb.group({rows:this.fb.array([])})}formatDisplayDate(i){return i?new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}copyDataToCouch(){}loadData(){}save(){}onNumberInput(i,t,n){}get rows(){return this.form.get("rows")}form;savedMessage=null;msgTimer=null;isDataLoaded=!1;isLoading=!1;isSaving=!1;isCopying=!1;copyProgress=null;productMap=new Map;AUTO_SAVE_INTERVAL=300*1e3;selectedDate=null;selectedLocation=null;subs=new q;ngOnInit(){this.subs.add(this.appState.selectedDate$.subscribe(i=>{this.selectedDate!==i&&(this.selectedDate=i,this.resetState())})),this.subs.add(this.appState.location$.subscribe(i=>{this.selectedLocation=i,this.resetState()})),this.setupAutoSave()}ngOnDestroy(){this.subs.unsubscribe(),this.msgTimer&&clearTimeout(this.msgTimer)}resetState(){}setupAutoSave(){}static \u0275fac=function(t){return new(t||e)(d(pt),d(b),d(N),d(I),d(B),d(M))};static \u0275cmp=T({type:e,selectors:[["app-receipt-entry"]],decls:11,vars:7,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center"],[1,"d-flex","gap-2"],["pButton","","type","button","label","COPY to COUCH",1,"p-button-info",3,"disabled"],["pButton","","type","button","label","Load Data",1,"p-button-primary"],["pButton","","type","submit","form","receiptEntryForm",1,"p-button-success",3,"disabled"],[1,"text-center","mt-4"],[1,"alert","alert-info","mt-3"],["pButton","","type","button","label","COPY to COUCH",1,"p-button-info",3,"click","disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],["pButton","","type","button","label","Load Data",1,"p-button-primary",3,"click"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"mt-2"],["role","alert",1,"alert","mt-2",3,"ngClass"],["id","receiptEntryForm",1,"mt-3",3,"ngSubmit","formGroup"],["scrollHeight","calc(100vh - 200px)","styleClass","p-datatable-sm p-datatable-gridlines","formArrayName","rows",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pFrozenColumn","",2,"width","70px"],["pFrozenColumn","",2,"width","250px"],[1,"text-end",2,"width","150px"],[3,"formGroupName"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3"),c(3),o(),r(4,"div",2),l(5,ye,2,2,"button",3),l(6,ge,1,0,"button",4),l(7,De,3,3,"button",5),o()(),l(8,ke,5,2,"div",6),l(9,Ie,2,0,"div",7),l(10,Pe,5,4),o()),t&2&&(a(3),x("Receipt Entry for ",n.formatDisplayDate(n.selectedDate)),a(2),p(n.isDataLoaded?-1:5),a(),p(!n.isDataLoaded&&!n.isLoading?6:-1),a(),p(n.isDataLoaded?7:-1),a(),p(n.isLoading||n.isCopying?8:-1),a(),p(!n.isDataLoaded&&!n.isLoading&&!n.isCopying?9:-1),a(),p(n.isDataLoaded&&!n.isLoading&&!n.isCopying?10:-1))},dependencies:[st,rt,ot,at,ct,lt,j,P,R,G,H,nt],styles:["input[type=tel][_ngcontent-%COMP%]{min-width:7ch}"]})};function je(e,i){let t;return(t=i.get("seq"))==null?null:t.value}function Oe(e,i){e&1&&h(0,"span",14)}function Ve(e,i){if(e&1){let t=g();r(0,"button",13),_("click",function(){f(t);let m=s();return v(m.copyDataToCouch())}),l(1,Oe,1,0,"span",14),o()}if(e&2){let t=s();u("disabled",t.isCopying),a(),p(t.isCopying?1:-1)}}function Ae(e,i){if(e&1){let t=g();r(0,"button",15),_("click",function(){f(t);let m=s();return v(m.loadData())}),o()}}function Fe(e,i){e&1&&c(0," Save ")}function Ne(e,i){e&1&&(h(0,"span",17),c(1," Saving... "))}function Be(e,i){if(e&1){let t=g();r(0,"button",16),_("click",function(){f(t);let m=s();return v(m.save())}),l(1,Fe,1,0),l(2,Ne,2,0),o()}if(e&2){let t=s();u("disabled",t.isSaving),a(),p(t.isSaving?-1:1),a(),p(t.isSaving?2:-1)}}function Me(e,i){if(e&1&&(r(0,"p",20),c(1),o()),e&2){let t=s(2);a(),S(t.copyProgress)}}function $e(e,i){if(e&1&&(r(0,"div",10)(1,"div",18)(2,"span",19),c(3),o()(),l(4,Me,2,1,"p",20),o()),e&2){let t=s();a(3),x("",t.isLoading?"Loading":"Copying","..."),a(),p(t.copyProgress?4:-1)}}function qe(e,i){e&1&&(r(0,"div",11),c(1,' Click "Load Data" to enter stock details. '),o())}function He(e,i){e&1&&(r(0,"tr")(1,"th",24),c(2,"Index"),o(),r(3,"th",25),c(4,"Name"),o(),r(5,"th",26),c(6,"Q"),o(),r(7,"th",26),c(8,"P"),o(),r(9,"th",26),c(10,"N"),o(),r(11,"th",26),c(12,"D"),o()())}function Ue(e,i){if(e&1){let t=g();r(0,"tr",27)(1,"td",28),c(2),o(),r(3,"td",28),c(4),o(),r(5,"td",29)(6,"input",30,0),_("change",function(){let m=f(t).$index,k=K(7),L=s(3);return v(L.onNumberInput(m,"qqty",k.value))}),o()(),r(8,"td",29)(9,"input",31,1),_("change",function(){let m=f(t).$index,k=K(10),L=s(3);return v(L.onNumberInput(m,"pqty",k.value))}),o()(),r(11,"td",29)(12,"input",32,2),_("change",function(){let m=f(t).$index,k=K(13),L=s(3);return v(L.onNumberInput(m,"nqty",k.value))}),o()(),r(14,"td",29)(15,"input",33,3),_("change",function(){let m=f(t).$index,k=K(16),L=s(3);return v(L.onNumberInput(m,"dqty",k.value))}),o()()()}if(e&2){let t,n=i.$implicit,m=i.$index;u("formGroupName",m),a(2),S(m+1),a(2),S((t=n.get("name"))==null?null:t.value)}}function Ge(e,i){if(e&1&&V(0,Ue,17,3,"tr",27,je),e&2){let t=s(2);A(t.rows.controls)}}function ze(e,i){if(e&1&&(r(0,"form",12)(1,"p-table",21),w(2,He,13,0,"ng-template",22)(3,Ge,2,0,"ng-template",23),o()()),e&2){let t=s();u("formGroup",t.form),a(),u("value",t.rows.controls)("scrollable",!0)}}var Ct=class e{constructor(i,t,n,m,k,L){this.fb=i;this.appState=t;this.stockService=n;this.productService=m;this.couchSync=k;this.couchData=L;this.form=this.fb.group({rows:this.fb.array([])})}formatDisplayDate(i){return i?new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}copyDataToCouch(){}loadData(){}save(){}onNumberInput(i,t,n){}get rows(){return this.form.get("rows")}form;savedMessage=null;msgTimer=null;isDataLoaded=!1;isLoading=!1;isSaving=!1;isCopying=!1;copyProgress=null;productMap=new Map;AUTO_SAVE_INTERVAL=300*1e3;selectedDate=null;selectedLocation=null;subs=new q;ngOnInit(){this.subs.add(this.appState.selectedDate$.subscribe(i=>{this.selectedDate!==i&&(this.selectedDate=i,this.resetState())})),this.subs.add(this.appState.location$.subscribe(i=>{this.selectedLocation=i,this.resetState()})),this.setupAutoSave()}ngOnDestroy(){this.subs.unsubscribe(),this.msgTimer&&clearTimeout(this.msgTimer)}resetState(){}setupAutoSave(){}static \u0275fac=function(t){return new(t||e)(d(pt),d(b),d(F),d(I),d(B),d(M))};static \u0275cmp=T({type:e,selectors:[["app-stock-entry"]],decls:11,vars:7,consts:[["qqtyInput",""],["pqtyInput",""],["nqtyInput",""],["dqtyInput",""],[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"d-flex","gap-2"],["pButton","","type","button","label","COPY to COUCH",1,"p-button-info",3,"disabled"],["pButton","","type","button","label","Load Data",1,"p-button-primary"],["pButton","","type","button",1,"p-button-success",3,"disabled"],[1,"text-center","mt-4"],[1,"alert","alert-info"],[1,"mt-3",3,"formGroup"],["pButton","","type","button","label","COPY to COUCH",1,"p-button-info",3,"click","disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],["pButton","","type","button","label","Load Data",1,"p-button-primary",3,"click"],["pButton","","type","button",1,"p-button-success",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"mt-2"],["scrollHeight","calc(100vh - 250px)","styleClass","p-datatable-sm p-datatable-gridlines","formArrayName","rows",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pFrozenColumn","",2,"width","70px"],["pFrozenColumn","",2,"width","250px"],[1,"text-end",2,"width","150px"],[3,"formGroupName"],["pFrozenColumn",""],[1,"text-end"],["type","tel","formControlName","qqty",1,"form-control","form-control-sm","text-end",3,"change"],["type","tel","formControlName","pqty",1,"form-control","form-control-sm","text-end",3,"change"],["type","tel","formControlName","nqty",1,"form-control","form-control-sm","text-end",3,"change"],["type","tel","formControlName","dqty",1,"form-control","form-control-sm","text-end",3,"change"]],template:function(t,n){t&1&&(r(0,"div",4)(1,"div",5)(2,"h3"),c(3),o(),r(4,"div",6),l(5,Ve,2,2,"button",7),l(6,Ae,1,0,"button",8),l(7,Be,3,3,"button",9),o()(),l(8,$e,5,2,"div",10),l(9,qe,2,0,"div",11),l(10,ze,4,3,"form",12),o()),t&2&&(a(3),x("Stock Entry for ",n.formatDisplayDate(n.selectedDate)),a(2),p(n.isDataLoaded?-1:5),a(),p(!n.isDataLoaded&&!n.isLoading?6:-1),a(),p(n.isDataLoaded?7:-1),a(),p(n.isLoading||n.isCopying?8:-1),a(),p(!n.isDataLoaded&&!n.isLoading&&!n.isCopying?9:-1),a(),p(n.isDataLoaded&&!n.isLoading&&!n.isCopying?10:-1))},dependencies:[st,rt,jt,Ot,ot,at,Vt,ct,lt,j,P,R,G,H],styles:["input[type=tel][_ngcontent-%COMP%]{min-width:7ch}"]})};function Qe(e,i){e&1&&h(0,"span",8)}function Ye(e,i){if(e&1){let t=g();r(0,"button",7),_("click",function(){f(t);let m=s();return v(m.copyDataToCouch())}),l(1,Qe,1,0,"span",8),o()}if(e&2){let t=s();u("disabled",t.isCopying),a(),p(t.isCopying?1:-1)}}function Je(e,i){if(e&1){let t=g();r(0,"button",9),_("click",function(){f(t);let m=s();return v(m.loadData())}),o()}}function Ke(e,i){if(e&1&&(r(0,"div",5)(1,"div",10)(2,"span",11),c(3),o()(),r(4,"p",12),c(5),o()()),e&2){let t=s();a(3),x("",t.isLoading?"Loading":"Copying","..."),a(2),S(t.isCopying?t.copyProgress:"Loading prices...")}}function We(e,i){e&1&&(r(0,"tr")(1,"th",16),c(2,"Index"),o(),r(3,"th"),c(4,"Name"),o(),r(5,"th",17),c(6,"Quarter"),o(),r(7,"th",17),c(8,"Pint"),o(),r(9,"th",17),c(10,"Nip"),o(),r(11,"th",17),c(12,"Drink"),o()())}function Xe(e,i){if(e&1&&(r(0,"tr")(1,"td"),c(2),o(),r(3,"td"),c(4),o(),r(5,"td",18),c(6),o(),r(7,"td",18),c(8),o(),r(9,"td",18),c(10),o(),r(11,"td",18),c(12),o()()),e&2){let t=i.$implicit,n=i.$index,m=s(3);a(2),S(n+1),a(2),S(t.name),a(2),S(m.displayVal(t.q)),a(2),S(m.displayVal(t.p)),a(2),S(m.displayVal(t.n)),a(2),S(m.displayVal(t.d))}}function Ze(e,i){if(e&1&&V(0,Xe,13,6,"tr",null,tt),e&2){let t=s(2);A(t.sortedProducts)}}function ti(e,i){e&1&&(r(0,"tr")(1,"td",19),c(2,"No products found for this location."),o()())}function ei(e,i){if(e&1&&(r(0,"p-table",6),w(1,We,13,0,"ng-template",13)(2,Ze,2,0,"ng-template",14)(3,ti,3,0,"ng-template",15),o()),e&2){let t=s();u("value",t.sortedProducts)("scrollable",!0)}}function ii(e,i){e&1&&(r(0,"div",5)(1,"p"),c(2,'Click "Load Data" to see the price list for the selected location and date.'),o()())}var St=class e{constructor(i,t,n,m,k){this.router=i;this.appState=t;this.productService=n;this.couchSync=m;this.couchData=k}copyDataToCouch(){this.isCopying=!0,this.copyProgress="Copying data to CouchDB...",setTimeout(()=>{this.isCopying=!1,this.copyProgress="Copy complete!"},1500)}get sortedProducts(){return[...this.products].sort((i,t)=>(i.seq??0)-(t.seq??0))}displayVal(i){return i==null?"":typeof i=="object"?Object.values(i).filter(t=>t!=null).join(", "):i.toString()}products=[];selectedDate=null;selectedLocation=null;isDataLoaded=!1;isLoading=!1;isCopying=!1;copyProgress=null;subs=new q;ngOnInit(){this.subs.add(this.appState.selectedDate$.subscribe(i=>{this.selectedDate!==i&&(this.selectedDate=i,this.isDataLoaded=!1)})),this.subs.add(this.appState.location$.subscribe(i=>{this.selectedLocation=i,this.isDataLoaded=!1}))}loadData(){this.isDataLoaded||this.isLoading||(this.isLoading=!0,this.isDataLoaded=!1,this.couchData.getPrice().pipe(Tt(1),wt(()=>this.isLoading=!1)).subscribe({next:i=>{this.products=i?.products??[]}}))}ngOnDestroy(){this.subs.unsubscribe()}static \u0275fac=function(t){return new(t||e)(d(Pt),d(b),d(I),d(B),d(M))};static \u0275cmp=T({type:e,selectors:[["app-price-list"]],decls:10,vars:5,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"d-flex","gap-2"],["pButton","","type","button","label","COPY to COUCH",1,"p-button-info",3,"disabled"],["pButton","","type","button","label","Load Data",1,"p-button-info"],[1,"text-center","mt-5"],["scrollHeight","calc(100vh - 200px)","styleClass","p-datatable-sm p-datatable-striped p-datatable-gridlines",3,"value","scrollable"],["pButton","","type","button","label","COPY to COUCH",1,"p-button-info",3,"click","disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],["pButton","","type","button","label","Load Data",1,"p-button-info",3,"click"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"mt-2"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[2,"width","5rem"],[1,"text-end",2,"width","8rem"],[1,"text-end"],["colspan","6"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3"),c(3,"Price List"),o(),r(4,"div",2),l(5,Ye,2,2,"button",3),l(6,Je,1,0,"button",4),l(7,Ke,6,2,"div",5),l(8,ei,4,2,"p-table",6),l(9,ii,3,0,"div",5),o()()()),t&2&&(a(5),p(n.isDataLoaded?-1:5),a(),p(!n.isDataLoaded&&!n.isLoading?6:-1),a(),p(n.isLoading||n.isCopying?7:-1),a(),p(n.isDataLoaded&&!n.isLoading&&!n.isCopying?8:-1),a(),p(!n.isDataLoaded&&!n.isLoading?9:-1))},dependencies:[j,P,R],encapsulation:2})};var ni=[{path:"prices",component:St},{path:"stock-entry",component:Ct},{path:"receipt-entry",component:_t},{path:"day-sales",component:vt},{path:"r1-report",component:mt}],bt=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=Z({type:e});static \u0275inj=X({imports:[yt.forChild(ni),yt]})};var Mt=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=Z({type:e});static \u0275inj=X({imports:[bt]})};export{Mt as WsmModule};
